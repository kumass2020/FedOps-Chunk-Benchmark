import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from matplotlib.colors import LogNorm

target = [(1, '45', 11.578199028968811), (1, '49', 11.543134450912476), (1, '7', 11.577028512954712), (1, '5', 11.868386626243591), (1, '16', 11.765883564949036), (1, '29', 11.695515632629395), (1, '44', 11.89704966545105), (1, '18', 11.614947199821472), (1, '26', 11.648564219474792), (1, '34', 11.386470556259155), (1, '25', 11.64283299446106), (1, '22', 11.776675581932068), (1, '31', 11.665735125541687), (1, '37', 11.83730161190033), (1, '9', 11.711793422698975), (1, '17', 11.753337025642395), (1, '30', 11.955154418945312), (1, '23', 11.691070795059204), (1, '33', 11.753126740455627), (1, '21', 11.896198153495789), (1, '36', 11.45157527923584), (1, '14', 11.638557076454163), (1, '24', 11.661974549293518), (1, '0', 11.554826498031616), (1, '6', 11.686631917953491), (1, '39', 11.701411843299866), (1, '4', 11.770402789115906), (1, '32', 11.921192407608032), (1, '35', 11.766645073890686), (1, '43', 11.542747139930725), (1, '48', 11.58995509147644), (1, '3', 11.46390175819397), (1, '20', 11.857620120048523), (1, '40', 11.668781042098999), (1, '42', 11.566851258277893), (1, '46', 11.99235451221466), (1, '19', 11.705283999443054), (1, '11', 11.624063968658447), (1, '41', 11.552569031715393), (1, '2', 11.598180055618286), (1, '47', 11.516682267189026), (1, '13', 11.558246970176697), (1, '15', 11.496480345726013), (1, '38', 11.637126922607422), (1, '28', 11.530028700828552), (1, '1', 11.637270450592041), (1, '8', 12.016906380653381), (1, '27', 11.587302923202515), (1, '12', 11.693783044815063), (1, '10', 11.541765928268433), (2, '26', 3.384409725666046), (2, '4', 3.2951715141534805), (2, '37', 3.3814471065998077), (2, '16', 3.1096216440200806), (2, '2', 3.194296181201935), (2, '18', 2.9005775302648544), (2, '46', 3.773495078086853), (2, '12', 3.5542533099651337), (2, '44', 3.4031606316566467), (2, '40', 4.131746053695679), (2, '20', 3.7970727384090424), (2, '33', 3.0612872689962387), (2, '34', 2.735622376203537), (2, '30', 2.8829880207777023), (2, '22', 3.4325791895389557), (2, '47', 3.135388135910034), (2, '6', 3.7318572103977203), (2, '3', 2.5701696574687958), (2, '10', 2.802486777305603), (2, '13', 3.0877054035663605), (2, '39', 2.9019381999969482), (2, '43', 2.8886590898036957), (2, '32', 3.429051995277405), (2, '49', 3.1946146190166473), (2, '35', 3.7048042118549347), (2, '14', 2.8426438868045807), (2, '24', 2.832787275314331), (2, '15', 2.507774382829666), (2, '9', 2.955990791320801), (2, '48', 3.2282367646694183), (2, '17', 2.839680567383766), (2, '27', 3.982431322336197), (2, '42', 2.8753119111061096), (2, '8', 3.331250935792923), (2, '38', 3.3300852477550507), (2, '25', 3.11607426404953), (2, '0', 3.0908459424972534), (2, '7', 3.0747396647930145), (2, '31', 3.174668699502945), (2, '11', 3.4518765807151794), (2, '23', 4.10011425614357), (2, '21', 3.1987107396125793), (2, '45', 3.300433486700058), (2, '28', 2.6155967116355896), (2, '29', 3.0997442603111267), (2, '1', 3.578643023967743), (2, '41', 2.971985250711441), (2, '5', 3.1812491714954376), (2, '36', 3.2304110527038574), (2, '19', 3.599485844373703), (3, '29', 1.7639501243829727), (3, '21', 1.5405109822750092), (3, '24', 1.351986587047577), (3, '17', 1.4179456122219563), (3, '15', 1.2900580018758774), (3, '30', 1.373914547264576), (3, '1', 2.310947686433792), (3, '39', 1.791182279586792), (3, '36', 1.8655174113810062), (3, '2', 1.9375198408961296), (3, '13', 1.5419560819864273), (3, '31', 1.6995611488819122), (3, '14', 1.656785860657692), (3, '35', 1.9359286651015282), (3, '40', 2.6586738228797913), (3, '43', 1.3407996445894241), (3, '11', 2.0689092725515366), (3, '9', 1.7146594822406769), (3, '34', 1.5859374701976776), (3, '32', 1.9544903486967087), (3, '25', 1.4862095564603806), (3, '33', 1.3703010752797127), (3, '48', 1.745229333639145), (3, '18', 1.4094109535217285), (3, '20', 2.5243150144815445), (3, '16', 1.6059974431991577), (3, '5', 1.6980144530534744), (3, '28', 1.426380317658186), (3, '0', 1.6341194659471512), (3, '38', 1.9020771980285645), (3, '7', 1.8802718967199326), (3, '4', 2.2231458500027657), (3, '26', 2.1378012597560883), (3, '12', 2.053856238722801), (3, '3', 1.3103767409920692), (3, '8', 1.5039663165807724), (3, '45', 1.7836461663246155), (3, '41', 1.4976666420698166), (3, '6', 2.0615812987089157), (3, '49', 1.9199993163347244), (3, '27', 2.5938578993082047), (3, '46', 2.1472222954034805), (3, '22', 1.9200843423604965), (3, '44', 1.6719191074371338), (3, '10', 1.36509108543396), (3, '47', 1.9075713604688644), (3, '19', 2.769487202167511), (3, '23', 2.7270643562078476), (3, '37', 1.5753387957811356), (3, '42', 1.5186204686760902), (4, '1', 1.644407480955124), (4, '48', 1.3115860894322395), (4, '44', 1.4713398814201355), (4, '33', 1.1964382268488407), (4, '29', 1.3006715923547745), (4, '39', 1.360938936471939), (4, '25', 1.0361066609621048), (4, '6', 1.555409237742424), (4, '45', 1.2763449847698212), (4, '11', 1.2727205455303192), (4, '41', 1.0914312526583672), (4, '9', 1.2646841555833817), (4, '18', 1.009743768721819), (4, '20', 2.0737244710326195), (4, '14', 1.2763584349304438), (4, '8', 1.201459214091301), (4, '23', 2.536172643303871), (4, '16', 1.021965131163597), (4, '4', 1.6258189920336008), (4, '2', 1.6088891699910164), (4, '27', 1.8887164443731308), (4, '10', 0.9251568168401718), (4, '13', 1.0623330622911453), (4, '15', 1.101877637207508), (4, '49', 1.5865442231297493), (4, '30', 1.0413963161408901), (4, '31', 1.3476094529032707), (4, '17', 1.1856753565371037), (4, '46', 1.8558340147137642), (4, '7', 1.4229512214660645), (4, '37', 1.2045186385512352), (4, '26', 1.520493969321251), (4, '19', 2.656951814889908), (4, '43', 0.836809977889061), (4, '0', 1.3601827919483185), (4, '38', 1.4462130665779114), (4, '12', 1.4988811314105988), (4, '21', 1.0175097212195396), (4, '36', 1.3295076601207256), (4, '24', 1.05935737490654), (4, '42', 1.0325345322489738), (4, '35', 1.541749268770218), (4, '47', 1.4936163276433945), (4, '32', 1.8433047533035278), (4, '28', 1.1477957088500261), (4, '22', 1.435981709510088), (4, '34', 0.963380865752697), (4, '3', 1.0261520892381668), (4, '40', 2.0898765474557877), (4, '5', 1.232251949608326), (5, '30', 0.8395598102360964), (5, '33', 0.9455530885607004), (5, '13', 1.0202503837645054), (5, '42', 0.7651896122843027), (5, '9', 0.934538010507822), (5, '44', 1.2570088505744934), (5, '39', 0.8245315216481686), (5, '16', 0.8166267517954111), (5, '48', 1.4431845843791962), (5, '43', 0.5913233533501625), (5, '28', 0.860101627651602), (5, '12', 1.0313613675534725), (5, '49', 1.1560405045747757), (5, '46', 1.508239172399044), (5, '32', 1.3439956083893776), (5, '15', 0.7570104412734509), (5, '6', 1.2853391915559769), (5, '23', 1.8700969032943249), (5, '4', 1.2931262049824), (5, '18', 0.7471239697188139), (5, '29', 1.0484411157667637), (5, '36', 1.078393865376711), (5, '8', 0.8248845115303993), (5, '20', 1.8807909600436687), (5, '5', 0.783336378633976), (5, '7', 1.1705756075680256), (5, '14', 0.9791807699948549), (5, '22', 1.158837877213955), (5, '24', 0.7751638069748878), (5, '47', 1.0680348947644234), (5, '3', 0.8022969029843807), (5, '2', 1.1453699506819248), (5, '40', 1.5910355597734451), (5, '41', 0.7797446344047785), (5, '11', 1.0711670219898224), (5, '19', 2.2091044187545776), (5, '1', 1.0615402162075043), (5, '37', 0.9350501373410225), (5, '21', 0.8468321040272713), (5, '34', 0.888819545507431), (5, '0', 1.1346308439970016), (5, '25', 0.8889142870903015), (5, '17', 0.9104251153767109), (5, '27', 1.6831949651241302), (5, '26', 1.282066747546196), (5, '45', 0.9553029015660286), (5, '35', 1.170065013691783), (5, '38', 1.265198789536953), (5, '10', 0.6914766281843185), (5, '31', 1.1442095786333084), (6, '31', 1.0512914396822453), (6, '38', 1.0648378878831863), (6, '24', 0.5618902072310448), (6, '4', 1.1721818149089813), (6, '11', 0.8253487199544907), (6, '8', 0.6626099161803722), (6, '21', 0.7730076275765896), (6, '20', 1.6206909753382206), (6, '28', 0.7646805793046951), (6, '37', 0.8139887228608131), (6, '48', 1.2186407446861267), (6, '18', 0.7322136778384447), (6, '5', 0.5663617663085461), (6, '33', 0.9376505203545094), (6, '39', 0.708793306723237), (6, '46', 1.387185461819172), (6, '30', 0.7899986729025841), (6, '23', 1.4687793627381325), (6, '25', 0.7371749356389046), (6, '49', 1.008039191365242), (6, '32', 1.2150323316454887), (6, '15', 0.8072616904973984), (6, '13', 0.6922646351158619), (6, '16', 0.7257183939218521), (6, '43', 0.46973781287670135), (6, '42', 0.7786325309425592), (6, '41', 0.6554439775645733), (6, '36', 0.8557595293968916), (6, '22', 1.064834788441658), (6, '1', 0.9776892550289631), (6, '40', 1.424195758998394), (6, '2', 1.1019678004086018), (6, '44', 0.9582561142742634), (6, '12', 0.8333808556199074), (6, '19', 1.9485454559326172), (6, '14', 0.777660476975143), (6, '3', 0.7959793210029602), (6, '45', 0.8776380494236946), (6, '10', 0.6205858811736107), (6, '47', 0.8505211174488068), (6, '7', 0.8856709375977516), (6, '6', 1.1032859422266483), (6, '27', 1.2608604580163956), (6, '29', 0.9208056218922138), (6, '35', 0.9761099144816399), (6, '9', 0.8379561305046082), (6, '26', 1.0208571776747704), (6, '17', 0.9284337591379881), (6, '34', 0.6753432378172874), (6, '0', 0.9201039373874664), (7, '11', 0.7206814959645271), (7, '42', 0.6200290638953447), (7, '21', 0.5756095871329308), (7, '17', 0.7124106306582689), (7, '0', 0.7252322509884834), (7, '31', 0.8269487572833896), (7, '36', 0.7089338582009077), (7, '40', 1.0739301890134811), (7, '30', 0.7436862550675869), (7, '6', 0.8820075318217278), (7, '48', 1.3263304606080055), (7, '7', 0.5944132097065449), (7, '23', 1.355731014162302), (7, '9', 0.8108409363776445), (7, '34', 0.5908913556486368), (7, '33', 0.8190273949876428), (7, '44', 0.827143594622612), (7, '45', 0.7588243298232555), (7, '8', 0.5626677935943007), (7, '16', 0.5798075124621391), (7, '37', 0.7171280048787594), (7, '22', 0.917595487087965), (7, '27', 1.0854292288422585), (7, '47', 0.6122105196118355), (7, '10', 0.5229689050465822), (7, '38', 0.9776154980063438), (7, '35', 0.8599755419418216), (7, '15', 0.6608985904604197), (7, '29', 0.86159841530025), (7, '20', 1.4382810406386852), (7, '2', 0.9503219705075026), (7, '41', 0.5722431801259518), (7, '32', 0.9467726945877075), (7, '26', 0.9953836053609848), (7, '24', 0.4301849529147148), (7, '18', 0.5914680566638708), (7, '5', 0.5373023599386215), (7, '25', 0.6313123144209385), (7, '49', 0.7638062834739685), (7, '39', 0.5618614535778761), (7, '14', 0.5973726757802069), (7, '12', 0.7747510895133018), (7, '1', 0.8213425204157829), (7, '4', 1.0420356197282672), (7, '13', 0.7366169728338718), (7, '46', 1.1152017079293728), (7, '28', 0.6522702192887664), (7, '3', 0.619245495647192), (7, '43', 0.41087694838643074), (7, '19', 1.9795143157243729), (8, '43', 0.45718590170145035), (8, '13', 0.7707774005830288), (8, '22', 0.8000250905752182), (8, '48', 1.1818656157702208), (8, '37', 0.6011857502162457), (8, '35', 0.9277588687837124), (8, '25', 0.5705033279955387), (8, '14', 0.5569530860520899), (8, '32', 0.8708597905933857), (8, '38', 1.12033761292696), (8, '39', 0.4875574866309762), (8, '49', 0.6051575625315309), (8, '45', 0.8123364076018333), (8, '30', 0.719056005589664), (8, '26', 0.9884380251169205), (8, '3', 0.5808220840990543), (8, '21', 0.4796775244176388), (8, '9', 0.8171713016927242), (8, '24', 0.3463562075048685), (8, '29', 1.0712841358035803), (8, '7', 0.5449439631775022), (8, '46', 1.0441334284842014), (8, '28', 0.59071209654212), (8, '10', 0.43048709258437157), (8, '34', 0.5307787470519543), (8, '1', 0.7720361389219761), (8, '44', 0.8177459184080362), (8, '17', 0.741494751535356), (8, '16', 0.6573308603838086), (8, '12', 0.7445879578590393), (8, '0', 0.6910536214709282), (8, '19', 1.8805576860904694), (8, '6', 0.8022046005353332), (8, '27', 0.9591808542609215), (8, '5', 0.5833823084831238), (8, '18', 0.5542771276086569), (8, '20', 1.3999267891049385), (8, '36', 0.6219603773206472), (8, '15', 0.7303880043327808), (8, '31', 0.8234733380377293), (8, '2', 1.0759804286062717), (8, '42', 0.6458338312804699), (8, '41', 0.5179812964051962), (8, '8', 0.5164420381188393), (8, '11', 0.7387374714016914), (8, '4', 0.8479580143466592), (8, '47', 0.558031477034092), (8, '23', 1.186612875200808), (8, '33', 0.6835205326788127), (8, '40', 0.9797084853053093), (9, '32', 0.9417725466191769), (9, '38', 0.9795053601264954), (9, '41', 0.4933033436536789), (9, '48', 0.9541481295600533), (9, '33', 0.7610471155494452), (9, '40', 0.8323145359754562), (9, '43', 0.29800791293382645), (9, '36', 0.6976644899696112), (9, '18', 0.5353395929560065), (9, '46', 1.0215520914644003), (9, '13', 0.5926571004092693), (9, '10', 0.3954564156010747), (9, '29', 0.9760245326906443), (9, '11', 0.6192610077559948), (9, '19', 1.80984166264534), (9, '15', 0.793210830539465), (9, '21', 0.4986661225557327), (9, '26', 0.7857472263276577), (9, '9', 0.7937389453873038), (9, '5', 0.6351055055856705), (9, '42', 0.6170492209494114), (9, '4', 0.6731266609858721), (9, '6', 0.7494145696982741), (9, '47', 0.5220132945105433), (9, '28', 0.5632737455889583), (9, '44', 0.8309242632240057), (9, '45', 0.655054060742259), (9, '0', 0.6078847125172615), (9, '16', 0.5342359766364098), (9, '30', 0.7096264697611332), (9, '17', 0.7595477476716042), (9, '31', 0.7326604090631008), (9, '37', 0.5931001715362072), (9, '1', 0.6728398613631725), (9, '35', 0.8891940340399742), (9, '3', 0.7034823633730412), (9, '39', 0.5920628975145519), (9, '25', 0.5321435313671827), (9, '34', 0.46361705381423235), (9, '14', 0.6274408297613263), (9, '22', 0.7429456915706396), (9, '24', 0.40608106926083565), (9, '7', 0.4575077500194311), (9, '20', 1.1565609015524387), (9, '12', 0.7603259049355984), (9, '49', 0.6037792069837451), (9, '27', 0.8585343919694424), (9, '23', 1.1996944220736623), (9, '8', 0.5721678454428911), (9, '2', 1.028197294101119), (10, '30', 0.5927053615450859), (10, '19', 1.5150708854198456), (10, '3', 0.5236866381019354), (10, '17', 0.6727592432871461), (10, '21', 0.5053855441510677), (10, '27', 0.7488778941333294), (10, '7', 0.5025250539183617), (10, '43', 0.264490969479084), (10, '48', 1.0995180578902364), (10, '32', 0.807817567139864), (10, '10', 0.3364163478836417), (10, '1', 0.46246856451034546), (10, '23', 0.9422376919537783), (10, '8', 0.4052929002791643), (10, '5', 0.47866472229361534), (10, '26', 0.6926515214145184), (10, '34', 0.5180859956890345), (10, '13', 0.4718137215822935), (10, '40', 0.6974970325827599), (10, '28', 0.46304336097091436), (10, '29', 0.81221894454211), (10, '47', 0.3767672753892839), (10, '41', 0.43922359589487314), (10, '24', 0.3665430210530758), (10, '12', 0.6567128449678421), (10, '2', 0.7136561740189791), (10, '35', 0.7041845545172691), (10, '11', 0.5808796864002943), (10, '49', 0.5719878301024437), (10, '22', 0.7227482628077269), (10, '20', 1.0267402790486813), (10, '31', 0.7298431983217597), (10, '25', 0.45867638662457466), (10, '45', 0.6156008262187243), (10, '6', 0.7463640198111534), (10, '42', 0.516272658482194), (10, '4', 0.6776244230568409), (10, '38', 0.8119433894753456), (10, '39', 0.44950021523982286), (10, '0', 0.5178185179829597), (10, '16', 0.5419724863022566), (10, '9', 0.6688483133912086), (10, '46', 1.1455802991986275), (10, '18', 0.4880041219294071), (10, '14', 0.4804636468179524), (10, '37', 0.6323908902704716), (10, '15', 0.5310814753174782), (10, '36', 0.5033441418781877), (10, '33', 0.7199940658174455), (10, '44', 0.6924062110483646)]

loss_list = [[] for i in range(50)]
for data in target:
    client_num = int(data[1])
    if data[0] == 1:
        loss_list[client_num].append(client_num)

    loss_list[client_num].append(data[2])

print(loss_list)

# Setup
sns.set_context("talk")  # This changes the scale of the fonts, you can use "poster" for even bigger fonts

# Taking 10 clients and 10 rounds worth of data
subset_data = [row[1:11] for row in loss_list[:10]]

# Determine min and max values for the color scale, avoiding zero
min_val = max(min(map(min, subset_data)), 0.1)
max_val = max(map(max, subset_data))

# Use logarithmic color scale
plt.figure(figsize=(20, 8))
ax = sns.heatmap(subset_data, norm=LogNorm(vmin=min_val, vmax=max_val), cmap="Reds", cbar_kws={'label': 'Loss (Log scale)'})

# Set font size
ax.set_xlabel("Round", fontsize=18)
ax.set_ylabel("Client Number", fontsize=18)
ax.set_xticklabels([f"Round {i}" for i in range(1, 11)], fontsize=16)
ax.set_yticklabels([i for i in range(10)], fontsize=16)
ax.set_title("Loss Map", fontsize=20)

cbar = ax.collections[0].colorbar
cbar.ax.tick_params(labelsize=16)
cbar.set_label('Loss (Log scale)', size=18)

plt.savefig("figure_lossmap.png", dpi=600)  # Added dpi argument here
plt.show()
